{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport WysiwygEditor from '../../components/wysiwyg-editor';\nimport Layout from '../../components/layout';\nimport { useState, useEffect } from 'react';\nimport Axios from 'axios';\nimport { uploadCallback } from '../../utils/upload';\nimport config from '../../config';\nimport getInitialData from '../../store/data';\nimport MultiSelect from '@khanacademy/react-multi-select';\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { state } from '../../store/redux';\n\nfunction Post(props) {\n  var [imgSrc, setImg] = useState('');\n  var [file, setFile] = useState('');\n  var refFile = React.createRef();\n  var [data, setData] = useState({\n    title: '',\n    content: '',\n    description: '',\n    viewCount: 0,\n    image: '',\n    idCategory: '',\n    idCreator: '5eb91ac9be4f1e373075d1b3',\n    tags: [],\n    compositions: []\n  });\n  var [optionComposition, setoptionComposition] = useState([]);\n  var [selectedCompos, setSelectedCompos] = useState([]);\n  useEffect(() => {\n    if (props.isData) {\n      var compos = props.compositions.map(item => {\n        return _objectSpread({}, item, {\n          label: item.name,\n          value: item.id\n        });\n      });\n      setoptionComposition(compos);\n\n      if (data.idCategory == '' && props.categories.length > 0) {\n        data.idCategory = props.categories[0].id;\n        setData(data);\n      }\n    }\n  }, []);\n\n  var changeImg = file => {\n    // var reader = new FileReader()\n    // reader.readAsDataURL(file)\n    // reader.onloadend = function (e) {\n    //   setImg(reader.result)\n    // }.bind(this)\n    setImg(URL.createObjectURL(file));\n    setFile(file);\n  };\n\n  var callBack = (key, value) => {\n    switch (key) {\n      case 'EDITOR':\n        setData(_objectSpread({}, data, {\n          content: value\n        }));\n        break;\n\n      case 'POST':\n        console.log(key, value);\n\n        var newData = _objectSpread({}, data);\n\n        var newTags = data.tags.filter((item, index) => {\n          return item != '';\n        });\n        newData = _objectSpread({}, data, {\n          tags: newTags\n        });\n        setData(newData);\n\n        if (file == '') {\n          toast.error('Bạn chưa đăng ảnh bài viết !', {\n            autoClose: 3000\n          });\n          console.log('file');\n        } else if (newData.title == '' || newData.content == '' || newData.description == '' || newData.compositions.length == 0 || newData.tags.length == 0) {\n          console.log('key');\n          toast.error('Bạn phải nhập đầy đủ thông tin !', {\n            autoClose: 3000\n          });\n        } else {\n          post(newData);\n        }\n\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  var post = value => {\n    console.log(file);\n    var image = '';\n    uploadCallback(file).then(res => {\n      console.log(res);\n      image = res.imageLink;\n    }).then(() => {\n      var dataa = _objectSpread({}, value, {\n        image: image\n      });\n\n      setData(dataa);\n      Axios.post(config.host.base + config.path.base.posts, dataa, {\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: 'Bearer ' + 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVlYjkyMmMzZWViYjNlM2Y4MGUxYTY1NCIsImlhdCI6MTU4OTg1NTMxNn0.uilfD8znjUSYSlBkv1vRr3vJ4LyEr6Fp4Ri8HcEg-AM'\n        }\n      }).then(res2 => {\n        console.log(res2);\n      }).catch(e => console.log('Error: ', e));\n    }).catch(err => {\n      console.log('err', err);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(Layout, {\n    title: 'Blush'\n  }, props.isData ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"post px-md-4 px-3\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pt-5 pb-md-3 pb-3\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-8\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mb-3\"\n  }, /*#__PURE__*/React.createElement(\"h5\", null, \"Ti\\xEAu \\u0111\\u1EC1\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    className: \"form-control\",\n    multiple: true,\n    onChange: e => {\n      setData(_objectSpread({}, data, {\n        title: e.target.value\n      }));\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mb-3\"\n  }, /*#__PURE__*/React.createElement(\"h5\", null, \"M\\xF4 t\\u1EA3 ng\\u1EAFn\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    className: \"form-control\",\n    multiple: true,\n    onChange: e => {\n      setData(_objectSpread({}, data, {\n        description: e.target.value\n      }));\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-4\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"post-image\"\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    ref: refFile,\n    type: \"file\",\n    onChange: e => changeImg(e.target.files[0]),\n    className: \"d-none\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"border border-secondary post-image-container\",\n    title: \"\\u1EA2nh b\\xE0i vi\\u1EBFt\"\n  }, imgSrc ? /*#__PURE__*/React.createElement(\"img\", {\n    src: imgSrc,\n    style: {\n      objectFit: 'cover'\n    },\n    className: \"w-100 h-100\"\n  }) : /*#__PURE__*/React.createElement(\"p\", null, \"\\u1EA2nh b\\xE0i vi\\u1EBFt\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-outline-danger post-image-btn\",\n    onClick: () => {\n      refFile.current.click();\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    class: \"fas fa-upload\"\n  }))))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row justify-content-between\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-5\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group mb-3\"\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    for: \"exampleFormControlSelect1\"\n  }, \"Danh m\\u1EE5c\"), /*#__PURE__*/React.createElement(\"select\", {\n    class: \"form-control\",\n    onChange: e => {\n      console.log(e.target.value);\n      setData(_objectSpread({}, data, {\n        idCategory: e.target.value\n      }));\n    }\n  }, props.categories && props.categories.map((item, index) => {\n    return /*#__PURE__*/React.createElement(\"option\", {\n      value: item.id,\n      selected: data.idCategory == props.categories[index].id ? true : false\n    }, item.name);\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-5\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"post-compos mb-3\"\n  }, /*#__PURE__*/React.createElement(\"h5\", null, \"Th\\xE0nh ph\\u1EA7n\"), /*#__PURE__*/React.createElement(MultiSelect, {\n    options: optionComposition,\n    selected: data.compositions,\n    onSelectedChanged: selected => {\n      console.log(selected);\n      setData(_objectSpread({}, data, {\n        compositions: selected\n      })); // setSelectedCompos(selected)\n    },\n    overrideStrings: {\n      selectSomeItems: 'Chọn ít nhất một thành phần...',\n      allItemsAreSelected: 'Tất cả được chọn',\n      selectAll: 'Chọn tất cả',\n      search: 'Tìm kiếm'\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-8\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mb-3\"\n  }, /*#__PURE__*/React.createElement(\"h5\", null, \"Tags\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    className: \"form-control\",\n    multiple: true,\n    placeholder: \"V\\xED d\\u1EE5 nh\\u1EADp tags: M\\u1EE5n,D\\u1EA7u,Da Kh\\xF4\",\n    value: data.tags.join(','),\n    onChange: e => {\n      setData(_objectSpread({}, data, {\n        tags: e.target.value.split(',')\n      }));\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(\"h5\", {\n    className: \"mb-3\"\n  }, \"N\\u1ED9i dung b\\xE0i vi\\u1EBFt\"), /*#__PURE__*/React.createElement(WysiwygEditor, {\n    callBack: callBack,\n    valueTxt: data.description\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row justify-content-center pt-5 mx-0\"\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    class: \"btn btn-danger text-uppercase font-weight-bold\",\n    onClick: () => callBack('POST', data)\n  }, \"\\u0110\\u0103ng b\\xE0i\"))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pt-5\"\n  }, /*#__PURE__*/React.createElement(\"h4\", null, \"Hi\\u1EC7n t\\u1EA1i h\\u1EC7 th\\u1ED1ng \\u0111ang l\\u1ED7i !\")));\n}\n\nPost.getInitialProps = /*#__PURE__*/_asyncToGenerator(function* () {\n  var data = yield getInitialData();\n\n  if (data.categories.length == 0 && data.compositions.length == 0) {\n    return {\n      isData: false\n    };\n  }\n\n  return _objectSpread({}, data, {\n    isData: true\n  });\n});\nexport default Post;","map":null,"metadata":{},"sourceType":"module"}