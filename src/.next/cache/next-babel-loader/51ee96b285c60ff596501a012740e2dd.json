{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Layout from '../../../components/layout';\nimport { useState, useEffect, useRef } from 'react';\nimport Axios from 'axios';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport config from '../../../config';\nimport '../../../static/styles/composition.scss';\nimport Cookies from 'universal-cookie';\nimport { getInitialDataAside } from '../../../store/data';\n\nfunction Composition(props) {\n  var _useState = useState([]),\n      data = _useState[0],\n      setData = _useState[1];\n\n  var _useState2 = useState(''),\n      value = _useState2[0],\n      setValue = _useState2[1];\n\n  var _useState3 = useState(false),\n      isLoad = _useState3[0],\n      setLoad = _useState3[1];\n\n  useEffect(function () {\n    setData(props.categories);\n  }, []);\n\n  var callBack = function callBack(key, value) {\n    console.log(key, value);\n\n    switch (key) {\n      case 'POST_COMPOSITON':\n        if (value != '') {\n          setLoad(true);\n          Axios.post(config.host.base + config.path.base.categories, {\n            name: value\n          }, {\n            headers: {\n              'Content-Type': 'application/json',\n              Authorization: 'Bearer ' + new Cookies().get('user').token\n            }\n          }).then(function (res) {\n            data.unshift(res.data);\n            setData(data);\n            toast.success('Thêm thành công !', {\n              autoClose: 3000\n            });\n            setValue('');\n          })[\"catch\"](function (err) {\n            console.log('POST_COMPOSITON', err);\n            toast.error('Không thành công !', {\n              autoClose: 3000\n            });\n          })[\"finally\"](function (fil) {\n            setLoad(false);\n          });\n        } else {\n          toast.error('Bạn chưa nhập thành phần !', {\n            autoClose: 3000\n          });\n        }\n\n        break;\n\n      case 'DELETE':\n        setLoad(true);\n        console.log(config.host.base + config.path.base.categories + '/' + value.item.id);\n        Axios[\"delete\"](config.host.base + config.path.base.categories + '/' + value.item.id, {\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: 'Bearer ' + new Cookies().get('user').token\n          }\n        }).then(function (res) {\n          data.splice(value.index, 1);\n          setData(data);\n          toast.success('Xoá thành công !', {\n            autoClose: 3000\n          });\n        })[\"catch\"](function (err) {\n          console.log('POST_COMPOSITON', err);\n          toast.error('Không thành công !', {\n            autoClose: 3000\n          });\n        })[\"finally\"](function (fil) {\n          setLoad(false);\n        });\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  var changeInput = function changeInput(value) {\n    setValue(value.target.value);\n  };\n\n  return __jsx(Layout, {\n    title: 'Danh mục',\n    compositions: props.compositions,\n    categories: props.categories\n  }, __jsx(\"div\", {\n    className: \"composition px-md-4 px-3\"\n  }, __jsx(\"div\", {\n    className: \"py-5\"\n  }, __jsx(\"div\", {\n    className: \"row align-items-end\"\n  }, __jsx(\"div\", {\n    className: \"col-xl-6 col-lg-7 col-sm-9 col-12\"\n  }, __jsx(\"h5\", null, \"Danh m\\u1EE5c\"), __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control mb-sm-0 mb-3\",\n    multiple: true,\n    value: value,\n    onChange: function onChange(e) {\n      changeInput(e);\n    },\n    onKeyPress: function onKeyPress(e) {\n      if (e.key == 'Enter') {\n        callBack('POST_COMPOSITON', value);\n      }\n    }\n  })), __jsx(\"div\", {\n    className: \"col-3\"\n  }, isLoad ? __jsx(\"div\", {\n    className: \"spinner-border text-primary\",\n    role: \"status\"\n  }, __jsx(\"span\", {\n    className: \"sr-only\"\n  }, \"Loading...\")) : __jsx(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary text-uppercase font-weight-bold\",\n    onClick: function onClick() {\n      return callBack('POST_COMPOSITON', value);\n    }\n  }, \"Th\\xEAm\")))), __jsx(\"div\", {\n    className: \"row\"\n  }, data && data.map(function (item, index) {\n    return __jsx(\"div\", {\n      className: \"col-lg-3 col-md-4 col-sm-6 col-12\"\n    }, __jsx(\"li\", {\n      className: \"list-group-item d-flex justify-content-between align-items-center px-3 my-3\"\n    }, item.name, __jsx(\"span\", {\n      className: \"badge badge-danger cursor-pointer ml-2\",\n      onClick: function onClick() {\n        return callBack('DELETE', {\n          item: item,\n          index: index\n        });\n      }\n    }, __jsx(\"span\", {\n      ariaHidden: \"true\"\n    }, \"\\xD7\"))));\n  }))));\n}\n\nComposition.getInitialProps = function _callee(ctx) {\n  var categories, req, res, query, cookies, user, data, _res;\n\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          categories = [];\n          req = ctx.req, res = ctx.res, query = ctx.query;\n          cookies = new Cookies();\n          user = cookies.get('user');\n          _context.next = 6;\n          return _regeneratorRuntime.awrap(getInitialDataAside());\n\n        case 6:\n          data = _context.sent;\n\n          if (!user) {\n            _context.next = 15;\n            break;\n          }\n\n          _context.next = 10;\n          return _regeneratorRuntime.awrap(Axios.get(config.host.base + config.path.base.categories)[\"catch\"](function (e) {\n            return console.log('Error: ', e.code);\n          }));\n\n        case 10:\n          _res = _context.sent;\n          categories = _res && _res.data ? _res.data : [];\n          return _context.abrupt(\"return\", _objectSpread({}, data, {\n            categories: categories\n          }));\n\n        case 15:\n          res.redirect('/');\n\n        case 16:\n          return _context.abrupt(\"return\", _objectSpread({}, data));\n\n        case 17:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nexport default Composition;","map":null,"metadata":{},"sourceType":"module"}