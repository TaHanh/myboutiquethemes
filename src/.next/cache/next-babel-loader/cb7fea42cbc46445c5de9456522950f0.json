{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport Layout from '../../../components/layout';\nimport { useState, useEffect, useRef } from 'react';\nimport Axios from 'axios';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport config from '../../../config';\nimport '../../../static/styles/composition.scss';\nimport Cookies from 'universal-cookie';\nimport { getParamsURL } from '../../../utils/convert';\n\nfunction Youtube(props) {\n  const {\n    0: data,\n    1: setData\n  } = useState(props.data);\n  const {\n    0: value,\n    1: setValue\n  } = useState('');\n  const {\n    0: isLoad,\n    1: setLoad\n  } = useState(false);\n  const {\n    0: token,\n    1: setToken\n  } = useState('');\n  useEffect(() => {\n    let tk = new Cookies().get('user');\n    console.log(tk);\n\n    if (tk) {\n      setToken(tk.token);\n    }\n  }, []);\n\n  const callBack = (key, value) => {\n    console.log(key, value);\n\n    switch (key) {\n      case 'POST':\n        if (value != '') {\n          setLoad(true);\n          Axios.post(config.host.base + config.path.base.youtubes, {\n            title: '',\n            link: value\n          }, {\n            headers: {\n              'Content-Type': 'application/json',\n              Authorization: 'Bearer ' + token\n            }\n          }).then(res => {\n            console.log(res.data);\n            data.rows.unshift(res.data);\n            setData(data);\n            toast.success('Thêm thành công !', {\n              autoClose: 3000\n            });\n            setValue('');\n          }).catch(err => {\n            console.log('POST', err);\n            toast.error('Không thành công !', {\n              autoClose: 3000\n            });\n          }).finally(fil => {\n            setLoad(false);\n          });\n        } else {\n          toast.error('Bạn chưa nhập thành phần !', {\n            autoClose: 3000\n          });\n        }\n\n        break;\n\n      case 'DELETE':\n        setLoad(true);\n        Axios.delete(config.host.base + config.path.base.youtubes + '/' + value.item.id, {\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: 'Bearer ' + token\n          }\n        }).then(res => {\n          data.rows.splice(value.index, 1);\n          setData(data);\n          toast.success('Xoá thành công !', {\n            autoClose: 3000\n          });\n        }).catch(err => {\n          console.log('POST', err);\n          toast.error('Không thành công !', {\n            autoClose: 3000\n          });\n        }).finally(fil => {\n          setLoad(false);\n        });\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  const changeInput = value => {\n    setValue(value.target.value);\n  };\n\n  return __jsx(Layout, {\n    title: \"Glowish's Youtube\"\n  }, __jsx(\"div\", {\n    className: \"composition px-md-4 px-3\"\n  }, __jsx(\"div\", {\n    className: \"py-5\"\n  }, __jsx(\"div\", {\n    className: \"row align-items-end\"\n  }, __jsx(\"div\", {\n    className: \"col-xl-6 col-lg-7 col-sm-9 col-12\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    className: \"form-control mb-sm-0 mb-3\",\n    multiple: true,\n    value: value,\n    onChange: e => {\n      changeInput(e);\n    },\n    onKeyPress: e => {\n      if (e.key == 'Enter') {\n        callBack('POST', value);\n      }\n    },\n    placeholder: \"Th\\xEAm link youtube\"\n  })), __jsx(\"div\", {\n    className: \"col-3\"\n  }, isLoad ? __jsx(\"div\", {\n    className: \"spinner-border text-primary\",\n    role: \"status\"\n  }, __jsx(\"span\", {\n    className: \"sr-only\"\n  }, \"Loading...\")) : __jsx(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary text-uppercase font-weight-bold\",\n    onClick: () => callBack('POST', value)\n  }, \"Th\\xEAm\")))), __jsx(\"div\", {\n    className: \"row\"\n  }, data && data.rows && data.rows.map((item, index) => {\n    return __jsx(\"div\", {\n      className: \"col-lg-3 col-md-4 col-sm-6 col-12\"\n    }, __jsx(\"li\", {\n      className: \"list-group-item text-center my-3\"\n    }, __jsx(\"iframe\", {\n      width: \"100%\",\n      src: 'https://www.youtube.com/embed/' + getParamsURL(item.link),\n      frameborder: \"0\",\n      allow: \"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\",\n      allowfullscreen: true\n    }), __jsx(\"button\", {\n      className: \"btn btn-outline-danger btn-sm\",\n      onClick: () => callBack('DELETE', {\n        item,\n        index\n      })\n    }, \"Xo\\xE1\")));\n  }))));\n}\n\nYoutube.getInitialProps = async function (ctx) {\n  let data = [];\n  const {\n    req,\n    res,\n    query\n  } = ctx;\n  const cookies = new Cookies();\n  let user = cookies.get('user');\n\n  if (user) {\n    let resData = await Axios.get(config.host.base + config.path.base.youtubes).catch(e => console.log('Error: ', e.code));\n    console.log(resData);\n    data = resData && resData.data ? resData.data : [];\n    return {\n      data: data\n    };\n  } else {\n    res.redirect('/');\n  }\n};\n\nexport default Youtube;","map":null,"metadata":{},"sourceType":"module"}